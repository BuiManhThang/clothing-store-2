import { {{EntityName}} } from '../../../domain/entities/{{EntityName}}'
import { NotFoundError } from '../../../shared/errors/NotFoundError'
import { {{EntityName}}DtoUpdate, {{EntityName}}DtoView } from '../../dtos/{{EntityName}}Dto'
import { I{{EntityName}}Repo } from '../../../domain/interfaces/repositories/I{{EntityName}}Repo'
import { {{EntityName}}Mapper } from '../../mappers/{{EntityName}}Mapper'
import { IUserContextService } from '../../interfaces/IUserContextService'

export class Update{{EntityName}}UseCase {
  readonly #{{entityName}}Repo: I{{EntityName}}Repo

  constructor({{entityName}}Repo: I{{EntityName}}Repo) {
    this.#{{entityName}}Repo = {{entityName}}Repo
  }

  async execute(userContextService: IUserContextService | undefined, id: string, update{{entityName}}Dto: {{EntityName}}DtoUpdate): Promise<{{EntityName}}DtoView | null> {
    const old{{EntityName}} = await this.#{{entityName}}Repo.findById(id)
    if (!old{{EntityName}}) throw new NotFoundError('')

    const {{entityName}}: {{EntityName}} = {
      id: old{{EntityName}}.id,
    {{#each createColumns}}
      {{column_name}}: update{{entityName}}Dto.{{column_name}},
    {{/each}}
      createdAt: old{{EntityName}}.createdAt,
      createdBy: old{{EntityName}}.createdBy,
      modifiedAt: new Date(),
      modifiedBy: userContextService?.getCurrentUserId() || '',
    }

    const updated{{EntityName}} = await this.#{{entityName}}Repo.update(id, {{entityName}})

    if (updated{{EntityName}}) return {{EntityName}}Mapper.to{{EntityName}}DtoView(updated{{EntityName}})
    return null
  }
}
